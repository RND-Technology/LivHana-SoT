var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,o=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,u=(e,t)=>{for(var r in t||(t={}))l.call(t,r)&&o(e,r,t[r]);if(n)for(var r of n(t))a.call(t,r)&&o(e,r,t[r]);return e},s=(e,n)=>t(e,r(n)),c=(e,t,r)=>new Promise((n,l)=>{var a=e=>{try{u(r.next(e))}catch(t){l(t)}},o=e=>{try{u(r.throw(e))}catch(t){l(t)}},u=e=>e.done?n(e.value):Promise.resolve(e.value).then(a,o);u((r=r.apply(e,t)).next())});import{r as i}from"./vendor-react-D4912goE.js";import{a as d}from"./vendor-http-DpZCZaHO.js";const p="https://reasoning-gateway-980910443251.us-central1.run.app/api/reasoning",v=Number(6e4),f=()=>{const[e,t]=i.useState(null),[r,n]=i.useState("idle"),[l,a]=i.useState(null),[o,f]=i.useState(null),m=i.useRef(null),b=i.useRef(null),y=i.useCallback(()=>{t(null),n("idle"),a(null),f(null),m.current&&(m.current.close(),m.current=null),b.current&&(clearTimeout(b.current),b.current=null)},[]),h=i.useCallback(e=>{if(!e)return;if("undefined"==typeof window)return;const t=new EventSource(`${p}/stream/${e}`);m.current=t,b.current=setTimeout(()=>{t.close(),n("timeout"),f("Reasoning job timed out")},v),t.addEventListener("progress",e=>{var t;const r=JSON.parse(null!=(t=e.data)?t:"{}");n("progress"),a(e=>{var t;return s(u({},e),{partial:null!=(t=r.delta)?t:r,final:null==e?void 0:e.final})})}),t.addEventListener("completed",e=>{var r;clearTimeout(b.current);const l=JSON.parse(null!=(r=e.data)?r:"{}");n("completed"),a(e=>{var t;return s(u({},e),{final:null!=(t=l.output)?t:l,partial:null==e?void 0:e.partial})}),t.close()}),t.addEventListener("failed",e=>{var r,l;clearTimeout(b.current);const a=JSON.parse(null!=(r=e.data)?r:"{}");n("failed"),f(null!=(l=a.error)?l:"Reasoning job failed"),t.close()}),t.onerror=()=>{clearTimeout(b.current),n("error"),f("Stream connection lost"),t.close()}},[]),g=i.useCallback(e=>c(void 0,[e],function*({prompt:e,sessionId:r,metadata:l}){var o,u,s;try{n("submitting"),f(null),a(null);const o=yield d.post(`${p}/enqueue`,{prompt:e,sessionId:r,metadata:l}),{jobId:u}=o.data;return t(u),n("queued"),h(u),u}catch(c){const e=null!=(s=null==(u=null==(o=c.response)?void 0:o.data)?void 0:u.error)?s:c.message;throw n("error"),f(e),c}}),[h]),j=i.useCallback(e=>c(void 0,null,function*(){if(!e)return null;return(yield d.get(`${p}/result/${e}`)).data}),[]),O=i.useCallback(()=>c(void 0,null,function*(){const e="https://voice-service-980910443251.us-central1.run.app/api".replace("/api","/health/voice-mode");return(yield d.get(e)).data}),[]);return i.useEffect(()=>()=>y(),[y]),{jobId:e,status:r,result:l,error:o,submitJob:g,fetchResult:j,fetchHealth:O,reset:y}};export{f as u};
