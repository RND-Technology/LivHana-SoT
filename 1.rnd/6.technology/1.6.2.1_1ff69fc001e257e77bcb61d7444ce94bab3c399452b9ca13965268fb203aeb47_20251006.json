{"ast":null,"code":"import _objectSpread from\"/Users/jesseniesen/LivHana-Trinity-Local/LivHana-SoT/frontend/vibe-cockpit/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";var _process$env$REACT_AP,_process$env$REACT_AP2;import{useCallback,useEffect,useRef,useState}from'react';import axios from'axios';const API_BASE=(_process$env$REACT_AP=process.env.REACT_APP_REASONING_API_BASE)!==null&&_process$env$REACT_AP!==void 0?_process$env$REACT_AP:'/api/reasoning';const STREAM_TIMEOUT_MS=Number((_process$env$REACT_AP2=process.env.REACT_APP_REASONING_STREAM_TIMEOUT_MS)!==null&&_process$env$REACT_AP2!==void 0?_process$env$REACT_AP2:60000);export const useReasoningJob=()=>{const[jobId,setJobId]=useState(null);const[status,setStatus]=useState('idle');const[result,setResult]=useState(null);const[error,setError]=useState(null);const eventSourceRef=useRef(null);const timeoutRef=useRef(null);const reset=useCallback(()=>{setJobId(null);setStatus('idle');setResult(null);setError(null);if(eventSourceRef.current){eventSourceRef.current.close();eventSourceRef.current=null;}if(timeoutRef.current){clearTimeout(timeoutRef.current);timeoutRef.current=null;}},[]);const streamJob=useCallback(id=>{if(!id)return;const source=new EventSource(\"\".concat(API_BASE,\"/stream/\").concat(id));eventSourceRef.current=source;timeoutRef.current=setTimeout(()=>{source.close();setStatus('timeout');setError('Reasoning job timed out');},STREAM_TIMEOUT_MS);source.addEventListener('progress',event=>{var _event$data;const data=JSON.parse((_event$data=event.data)!==null&&_event$data!==void 0?_event$data:'{}');setStatus('progress');setResult(prev=>{var _data$delta;return _objectSpread(_objectSpread({},prev),{},{partial:(_data$delta=data.delta)!==null&&_data$delta!==void 0?_data$delta:data,final:prev===null||prev===void 0?void 0:prev.final});});});source.addEventListener('completed',event=>{var _event$data2;clearTimeout(timeoutRef.current);const data=JSON.parse((_event$data2=event.data)!==null&&_event$data2!==void 0?_event$data2:'{}');setStatus('completed');setResult(prev=>{var _data$output;return _objectSpread(_objectSpread({},prev),{},{final:(_data$output=data.output)!==null&&_data$output!==void 0?_data$output:data,partial:prev===null||prev===void 0?void 0:prev.partial});});source.close();});source.addEventListener('failed',event=>{var _event$data3,_data$error;clearTimeout(timeoutRef.current);const data=JSON.parse((_event$data3=event.data)!==null&&_event$data3!==void 0?_event$data3:'{}');setStatus('failed');setError((_data$error=data.error)!==null&&_data$error!==void 0?_data$error:'Reasoning job failed');source.close();});source.onerror=()=>{clearTimeout(timeoutRef.current);setStatus('error');setError('Stream connection lost');source.close();};},[]);const submitJob=useCallback(async _ref=>{let{prompt,sessionId,metadata}=_ref;try{setStatus('submitting');setError(null);setResult(null);const response=await axios.post(\"\".concat(API_BASE,\"/submit\"),{prompt,sessionId,metadata});const{jobId:newJobId}=response.data;setJobId(newJobId);setStatus('queued');streamJob(newJobId);return newJobId;}catch(submissionError){var _submissionError$resp,_submissionError$resp2,_submissionError$resp3;const message=(_submissionError$resp=(_submissionError$resp2=submissionError.response)===null||_submissionError$resp2===void 0?void 0:(_submissionError$resp3=_submissionError$resp2.data)===null||_submissionError$resp3===void 0?void 0:_submissionError$resp3.error)!==null&&_submissionError$resp!==void 0?_submissionError$resp:submissionError.message;setStatus('error');setError(message);throw submissionError;}},[streamJob]);const fetchResult=useCallback(async id=>{if(!id)return null;const response=await axios.get(\"\".concat(API_BASE,\"/result/\").concat(id));return response.data;},[]);useEffect(()=>()=>reset(),[reset]);return{jobId,status,result,error,submitJob,fetchResult,reset};};","map":{"version":3,"names":["useCallback","useEffect","useRef","useState","axios","API_BASE","_process$env$REACT_AP","process","env","REACT_APP_REASONING_API_BASE","STREAM_TIMEOUT_MS","Number","_process$env$REACT_AP2","REACT_APP_REASONING_STREAM_TIMEOUT_MS","useReasoningJob","jobId","setJobId","status","setStatus","result","setResult","error","setError","eventSourceRef","timeoutRef","reset","current","close","clearTimeout","streamJob","id","source","EventSource","concat","setTimeout","addEventListener","event","_event$data","data","JSON","parse","prev","_data$delta","_objectSpread","partial","delta","final","_event$data2","_data$output","output","_event$data3","_data$error","onerror","submitJob","_ref","prompt","sessionId","metadata","response","post","newJobId","submissionError","_submissionError$resp","_submissionError$resp2","_submissionError$resp3","message","fetchResult","get"],"sources":["/Users/jesseniesen/LivHana-Trinity-Local/LivHana-SoT/frontend/vibe-cockpit/src/hooks/useReasoningJob.js"],"sourcesContent":["import { useCallback, useEffect, useRef, useState } from 'react';\nimport axios from 'axios';\n\nconst API_BASE = process.env.REACT_APP_REASONING_API_BASE ?? '/api/reasoning';\nconst STREAM_TIMEOUT_MS = Number(process.env.REACT_APP_REASONING_STREAM_TIMEOUT_MS ?? 60000);\n\nexport const useReasoningJob = () => {\n  const [jobId, setJobId] = useState(null);\n  const [status, setStatus] = useState('idle');\n  const [result, setResult] = useState(null);\n  const [error, setError] = useState(null);\n  const eventSourceRef = useRef(null);\n  const timeoutRef = useRef(null);\n\n  const reset = useCallback(() => {\n    setJobId(null);\n    setStatus('idle');\n    setResult(null);\n    setError(null);\n    if (eventSourceRef.current) {\n      eventSourceRef.current.close();\n      eventSourceRef.current = null;\n    }\n    if (timeoutRef.current) {\n      clearTimeout(timeoutRef.current);\n      timeoutRef.current = null;\n    }\n  }, []);\n\n  const streamJob = useCallback((id) => {\n    if (!id) return;\n\n    const source = new EventSource(`${API_BASE}/stream/${id}`);\n    eventSourceRef.current = source;\n\n    timeoutRef.current = setTimeout(() => {\n      source.close();\n      setStatus('timeout');\n      setError('Reasoning job timed out');\n    }, STREAM_TIMEOUT_MS);\n\n    source.addEventListener('progress', (event) => {\n      const data = JSON.parse(event.data ?? '{}');\n      setStatus('progress');\n      setResult((prev) => ({ ...prev, partial: data.delta ?? data, final: prev?.final }));\n    });\n\n    source.addEventListener('completed', (event) => {\n      clearTimeout(timeoutRef.current);\n      const data = JSON.parse(event.data ?? '{}');\n      setStatus('completed');\n      setResult((prev) => ({ ...prev, final: data.output ?? data, partial: prev?.partial }));\n      source.close();\n    });\n\n    source.addEventListener('failed', (event) => {\n      clearTimeout(timeoutRef.current);\n      const data = JSON.parse(event.data ?? '{}');\n      setStatus('failed');\n      setError(data.error ?? 'Reasoning job failed');\n      source.close();\n    });\n\n    source.onerror = () => {\n      clearTimeout(timeoutRef.current);\n      setStatus('error');\n      setError('Stream connection lost');\n      source.close();\n    };\n  }, []);\n\n  const submitJob = useCallback(async ({ prompt, sessionId, metadata }) => {\n    try {\n      setStatus('submitting');\n      setError(null);\n      setResult(null);\n\n      const response = await axios.post(`${API_BASE}/submit`, { prompt, sessionId, metadata });\n      const { jobId: newJobId } = response.data;\n      setJobId(newJobId);\n      setStatus('queued');\n      streamJob(newJobId);\n      return newJobId;\n    } catch (submissionError) {\n      const message = submissionError.response?.data?.error ?? submissionError.message;\n      setStatus('error');\n      setError(message);\n      throw submissionError;\n    }\n  }, [streamJob]);\n\n  const fetchResult = useCallback(async (id) => {\n    if (!id) return null;\n    const response = await axios.get(`${API_BASE}/result/${id}`);\n    return response.data;\n  }, []);\n\n  useEffect(() => () => reset(), [reset]);\n\n  return {\n    jobId,\n    status,\n    result,\n    error,\n    submitJob,\n    fetchResult,\n    reset,\n  };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}