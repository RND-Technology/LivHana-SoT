var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,l=(t,s,n)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n,a=(e,t)=>{for(var s in t||(t={}))i.call(t,s)&&l(e,s,t[s]);if(n)for(var s of n(t))r.call(t,s)&&l(e,s,t[s]);return e},o=(e,n)=>t(e,s(n)),c=(e,t,s)=>new Promise((n,i)=>{var r=e=>{try{a(s.next(e))}catch(t){i(t)}},l=e=>{try{a(s.throw(e))}catch(t){i(t)}},a=e=>e.done?n(e.value):Promise.resolve(e.value).then(r,l);a((s=s.apply(e,t)).next())});import{j as d,P as x,B as u,f as p,b as h,I as m,u as g,C as f,O as j,d as b,J as y,e as v,o as w,aa as S,M as A,k,l as C}from"./vendor-mui-core-q5oQAHKb.js";import{r as E}from"./vendor-react-D4912goE.js";import{u as I}from"./useReasoningJob-DEX6RX-q.js";import{ax as R,a7 as z,ay as B,az as D,j as O,k as P,aA as T,aB as F,aC as M,aD as W,aE as $}from"./vendor-mui-icons-fVC7fdhd.js";import"./vendor-http-DpZCZaHO.js";const H=({open:e,onClose:t})=>{var s;const[n,i]=E.useState(""),[r,l]=E.useState(!1),[H,L]=E.useState(!1),[J,X]=E.useState([]),[Y,K]=E.useState([]),[U,V]=E.useState([]),[G,q]=E.useState(!0),[N,Q]=E.useState(4),[Z,_]=E.useState(null),[ee,te]=E.useState(null),se=E.useRef(null),ne=E.useRef([]),ie=E.useRef(null),re=E.useRef(null),le=E.useRef(null),ae=I();E.useEffect(()=>{var e;null==(e=le.current)||e.scrollIntoView({behavior:"smooth"})},[J,ae.result]),E.useEffect(()=>{var e;if("completed"===ae.status&&(null==(e=ae.result)?void 0:e.final)){const e=J[J.length-1];"response"!==(null==e?void 0:e.type)||e.text||X(t=>{const s=[...t];return s[s.length-1]=o(a({},e),{text:ae.result.final,timestamp:(new Date).toISOString(),status:"completed"}),s})}},[ae.status,null==(s=ae.result)?void 0:s.final]);const oe=e=>c(void 0,null,function*(){L(!0);try{const t=new FormData;t.append("audio",e,"recording.webm");const s=yield fetch("https://voice-service-980910443251.us-central1.run.app/api/whisper/transcribe",{method:"POST",body:t});if(!s.ok)throw new Error(`Transcription failed: ${s.status}`);const n=(yield s.json()).text;i(e=>e?`${e}\n${n}`:n)}catch(t){alert(`Voice transcription failed: ${t.message}`)}finally{L(!1)}}),ce=()=>c(void 0,null,function*(){if(!n.trim()&&0===Y.length&&0===U.length)return;const e={type:"user",text:n,files:[...Y],images:[...U],timestamp:(new Date).toISOString()};X(t=>[...t,e]);const t={type:"response",text:"",status:"thinking",timestamp:(new Date).toISOString()};X(e=>[...e,t]);try{yield ae.submitJob({prompt:n,sessionId:"chat-panel",metadata:{source:"chat-panel",hasFiles:Y.length>0,hasImages:U.length>0}})}catch(s){X(e=>{const t=[...e];return t[t.length-1]=o(a({},t[t.length-1]),{text:`Error: ${s.message}`,status:"error"}),t})}i(""),K([]),V([])}),de=()=>{_(null),te(null)};return e?d.jsxs(x,{elevation:8,sx:{position:"fixed",right:16,bottom:16,width:G?600:400,maxHeight:G?"80vh":"60vh",display:"flex",flexDirection:"column",bgcolor:"#1E293B",borderRadius:3,overflow:"hidden",transition:"all 0.3s",zIndex:1200,border:"2px solid #16A34A"},children:[d.jsxs(u,{sx:{p:2,bgcolor:"#16A34A",color:"white",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[d.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[d.jsx(p,{sx:{bgcolor:"white",color:"#16A34A",width:32,height:32},children:"LH"}),d.jsxs(u,{children:[d.jsx(h,{variant:"subtitle1",fontWeight:"bold",children:"Liv Hana Assistant"}),d.jsx(h,{variant:"caption",children:"progress"===ae.status?"Thinking...":"completed"===ae.status?"Ready":"Online"})]})]}),d.jsxs(u,{children:[d.jsx(m,{size:"small",onClick:()=>q(!G),sx:{color:"white"},children:G?d.jsx(R,{}):d.jsx(z,{})}),d.jsx(m,{size:"small",onClick:t,sx:{color:"white"},children:d.jsx(B,{})})]})]}),d.jsxs(u,{sx:{flexGrow:1,overflow:"auto",p:2,bgcolor:"#0F172A",display:"flex",flexDirection:"column",gap:2},children:[0===J.length&&d.jsxs(u,{sx:{textAlign:"center",py:4,color:"#64748B"},children:[d.jsx(h,{variant:"h6",gutterBottom:!0,children:"ðŸ‘‹ Hello! I'm Liv Hana"}),d.jsx(h,{variant:"body2",children:"Ask me anything using text, voice, files, or images!"})]}),J.map((e,t)=>d.jsx(u,{onContextMenu:e=>((e,t)=>{e.preventDefault(),_({mouseX:e.clientX,mouseY:e.clientY}),te(t)})(e,t),sx:{display:"flex",justifyContent:"user"===e.type?"flex-end":"flex-start"},children:d.jsxs(x,{sx:{p:2,maxWidth:"75%",bgcolor:"user"===e.type?"#16A34A":"#1E293B",color:"white",borderRadius:2},children:[e.text&&d.jsx(h,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:e.text}),"thinking"===e.status&&!e.text&&d.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[d.jsx(g,{size:16,sx:{color:"#16A34A"}}),d.jsx(h,{variant:"caption",color:"#64748B",children:"Reasoning..."})]}),e.files&&e.files.length>0&&d.jsx(u,{sx:{mt:1,display:"flex",flexWrap:"wrap",gap:.5},children:e.files.map((e,t)=>d.jsx(f,{size:"small",icon:d.jsx(D,{}),label:e.name,sx:{fontSize:"0.7rem"}},t))}),e.images&&e.images.length>0&&d.jsx(u,{sx:{mt:1,display:"flex",flexWrap:"wrap",gap:1},children:e.images.map((e,t)=>d.jsx("img",{src:e.preview,alt:e.name,style:{maxWidth:100,maxHeight:100,borderRadius:4}},t))}),d.jsx(h,{variant:"caption",sx:{display:"block",mt:.5,opacity:.7},children:new Date(e.timestamp).toLocaleTimeString()})]})},t)),d.jsx("div",{ref:le})]}),"progress"===ae.status&&d.jsx(j,{sx:{bgcolor:"#1E293B","& .MuiLinearProgress-bar":{bgcolor:"#16A34A"}}}),(Y.length>0||U.length>0)&&d.jsx(u,{sx:{p:1,bgcolor:"#1E293B",borderTop:"1px solid #334155"},children:d.jsxs(u,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:[Y.map((e,t)=>d.jsx(f,{icon:d.jsx(D,{}),label:e.name,onDelete:()=>(e=>{K(t=>t.filter((t,s)=>s!==e))})(t),size:"small",sx:{bgcolor:"#334155",color:"white"}},`file-${t}`)),U.map((e,t)=>d.jsx(b,{badgeContent:d.jsx(m,{size:"small",onClick:()=>(e=>{V(t=>t.filter((t,s)=>s!==e))})(t),sx:{bgcolor:"#EF4444",width:16,height:16,p:0},children:d.jsx(B,{sx:{fontSize:12,color:"white"}})}),children:d.jsx("img",{src:e.preview,alt:e.name,style:{width:40,height:40,borderRadius:4,objectFit:"cover"}})},`img-${t}`))]})}),d.jsxs(u,{sx:{p:2,bgcolor:"#1E293B",borderTop:"2px solid #334155"},children:[d.jsx(y,{fullWidth:!0,multiline:!0,rows:N,maxRows:12,value:n,onChange:e=>i(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),ce())},placeholder:"Ask Liv Hana anything... (Shift+Enter for new line)",disabled:H||"submitting"===ae.status,sx:{mb:1,"& .MuiInputBase-root":{bgcolor:"#0F172A",color:"white",fontSize:"0.9rem"},"& .MuiInputBase-input":{"&::placeholder":{color:"#64748B",opacity:1}}},InputProps:{endAdornment:d.jsx(v,{title:N<12?"Expand":"Collapse",children:d.jsx(m,{size:"small",onClick:()=>Q(e=>e<12?12:4),children:N<12?d.jsx(z,{}):d.jsx(R,{})})})}}),d.jsxs(u,{sx:{display:"flex",gap:1,justifyContent:"space-between",alignItems:"center"},children:[d.jsxs(u,{sx:{display:"flex",gap:.5},children:[d.jsx(v,{title:r?"Stop recording":"Start voice input",children:d.jsx(m,{onClick:r?()=>{se.current&&"recording"===se.current.state&&(se.current.stop(),l(!1))}:()=>c(void 0,null,function*(){try{const e=yield navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e,{mimeType:"audio/webm;codecs=opus"});se.current=t,ne.current=[],t.ondataavailable=e=>{e.data.size>0&&ne.current.push(e.data)},t.onstop=()=>c(void 0,null,function*(){e.getTracks().forEach(e=>e.stop());const t=new Blob(ne.current,{type:"audio/webm"});yield oe(t)}),t.start(),l(!0)}catch(e){alert(`Microphone access failed: ${e.message}`)}}),disabled:H||"submitting"===ae.status,sx:{color:r?"#EF4444":"#16A34A",bgcolor:r?"rgba(239, 68, 68, 0.1)":"rgba(22, 163, 74, 0.1)","&:hover":{bgcolor:r?"rgba(239, 68, 68, 0.2)":"rgba(22, 163, 74, 0.2)"},animation:r?"pulse 1.5s ease-in-out infinite":"none"},children:r?d.jsx(O,{}):H?d.jsx(g,{size:20}):d.jsx(P,{})})}),d.jsx(v,{title:"Attach file",children:d.jsx(m,{onClick:()=>{var e;return null==(e=ie.current)?void 0:e.click()},sx:{color:"#64748B"},children:d.jsx(T,{})})}),d.jsx("input",{ref:ie,type:"file",multiple:!0,hidden:!0,onChange:e=>{const t=Array.from(e.target.files);K(e=>[...e,...t])}}),d.jsx(v,{title:"Attach image",children:d.jsx(m,{onClick:()=>{var e;return null==(e=re.current)?void 0:e.click()},sx:{color:"#64748B"},children:d.jsx(F,{})})}),d.jsx("input",{ref:re,type:"file",multiple:!0,accept:"image/*",hidden:!0,onChange:e=>{Array.from(e.target.files).forEach(e=>{const t=new FileReader;t.onload=t=>{V(s=>[...s,{file:e,preview:t.target.result,name:e.name}])},t.readAsDataURL(e)})}})]}),d.jsx(w,{variant:"contained",endIcon:d.jsx(M,{}),onClick:ce,disabled:!n.trim()&&0===Y.length&&0===U.length||"submitting"===ae.status,sx:{bgcolor:"#16A34A","&:hover":{bgcolor:"#15803D"},textTransform:"none",fontWeight:600},children:"submitting"===ae.status?"Sending...":"Send"})]})]}),d.jsxs(S,{open:null!==Z,onClose:de,anchorReference:"anchorPosition",anchorPosition:null!==Z?{top:Z.mouseY,left:Z.mouseX}:void 0,children:[d.jsxs(A,{onClick:()=>{if(null!==ee){const e=J[ee];navigator.clipboard.writeText(e.text)}de()},children:[d.jsx(k,{children:d.jsx(W,{fontSize:"small"})}),d.jsx(C,{children:"Copy"})]}),d.jsxs(A,{onClick:()=>{null!==ee&&X(e=>e.filter((e,t)=>t!==ee)),de()},children:[d.jsx(k,{children:d.jsx($,{fontSize:"small"})}),d.jsx(C,{children:"Delete"})]})]}),d.jsx("style",{children:"\n        @keyframes pulse {\n          0%, 100% { opacity: 1; }\n          50% { opacity: 0.5; }\n        }\n      "})]}):null};export{H as default};
