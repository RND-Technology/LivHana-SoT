const e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,a=(t,s,n)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n,r=(e,t)=>{for(var s in t||(t={}))o.call(t,s)&&a(e,s,t[s]);if(n)for(var s of n(t))i.call(t,s)&&a(e,s,t[s]);return e},l=(e,n)=>t(e,s(n)),c=(e,t,s)=>new Promise((n,o)=>{var i=e=>{try{r(s.next(e))}catch(t){o(t)}},a=e=>{try{r(s.throw(e))}catch(t){o(t)}},r=e=>e.done?n(e.value):Promise.resolve(e.value).then(i,a);r((s=s.apply(e,t)).next())});import{j as d,v as u,w as x,S as h,B as m,C as b,x as g,y as v,z as p,b as j,m as y,n as f,F as A,E as C,G as S,M as w,H as k,J as E,o as I,u as D,P as R,K as T}from"./vendor-mui-core-q5oQAHKb.js";import{r as V}from"./vendor-react-D4912goE.js";import{u as $}from"./useReasoningJob-DEX6RX-q.js";import{h as F,i as O,j as M,k as P,l as W,m as z}from"./vendor-mui-icons-fVC7fdhd.js";import"./vendor-http-DpZCZaHO.js";const B=e=>{switch(e){case"healthy":return"success";case"degraded":return"warning";case"down":return"error";default:return"info"}},L=({voiceStatus:e,reasoningStatus:t,queueDepth:s})=>d.jsxs(u,{severity:B(t),sx:{backgroundColor:"#111827",color:"#E5E7EB"},"data-testid":"health-banner",children:[d.jsx(x,{children:"Voice Mode Service Health"}),d.jsxs(h,{direction:"row",spacing:2,alignItems:"center",children:[d.jsx(m,{children:d.jsx(b,{label:`Voice Service: ${e}`,color:B(e),variant:"outlined"})}),d.jsx(m,{children:d.jsx(b,{label:`Reasoning Gateway: ${t}`,color:B(t),variant:"outlined"})}),d.jsx(m,{children:d.jsx(b,{label:`Queue Depth: ${null!=s?s:"unknown"}`,color:"info",variant:"outlined"})})]})]}),q="https://voice-service-980910443251.us-central1.run.app/api",H=[{id:"21m00Tcm4TlvDq8ikWAM",name:"Rachel",description:"Professional, clear, and engaging female voice",gender:"Female",age:"30-40",accent:"American"},{id:"AZnzlk1XvdvUeBnXmlld",name:"Domi",description:"Warm, friendly, and approachable female voice",gender:"Female",age:"25-35",accent:"American"},{id:"EXAVITQu4vr4xnSDxMaL",name:"Bella",description:"Expressive, dynamic, and engaging female voice",gender:"Female",age:"20-30",accent:"American"},{id:"MF3mGyEYCl7XYWbV9V6O",name:"Elli",description:"Young, fresh, and vibrant female voice",gender:"Female",age:"18-25",accent:"American"}],U=({open:e,onClose:t,voiceModeActive:s,toggleVoiceMode:n,agentStatus:o,setAgentStatus:i})=>{let a,u,x;const[h,B]=V.useState(()=>localStorage.getItem("selectedVoice")||"21m00Tcm4TlvDq8ikWAM"),[U,J]=V.useState(!1),[G,N]=V.useState(!1),[X,Y]=V.useState(!1),[Q,K]=V.useState(""),[Z,_]=V.useState(50),[ee,te]=V.useState(50),[se,ne]=V.useState(80),[oe,ie]=V.useState(!1),[ae,re]=V.useState("Summarize the latest operations status for Liv Hana."),le=V.useRef(null),ce=V.useRef(null),de=V.useRef([]),ue=$(),[xe,he]=V.useState({voice:"unknown",reasoning:"unknown",queueDepth:"unknown"}),me=H.find(e=>e.id===h);V.useEffect(()=>{localStorage.setItem("selectedVoice",h)},[h]),V.useEffect(()=>{"completed"===ue.status&&he(e=>l(r({},e),{reasoning:"healthy"})),["failed","error","timeout"].includes(ue.status)&&he(e=>l(r({},e),{reasoning:"down"})),"progress"===ue.status&&he(e=>l(r({},e),{reasoning:"degraded"}))},[ue.status]),V.useEffect(()=>{let e=!1;const t=()=>c(void 0,null,function*(){try{const t=yield ue.fetchHealth();e||he(e=>{let s,n,o;return l(r({},e),{voice:null!=(s=t.voiceStatus)?s:e.voice,reasoning:null!=(n=t.reasoningStatus)?n:e.reasoning,queueDepth:null!=(o=t.queueDepth)?o:e.queueDepth})})}catch(t){e||he(e=>l(r({},e),{voice:"down",reasoning:"degraded"}))}});t();const s=setInterval(t,3e4);return()=>{e=!0,clearInterval(s)}},[ue]);const be=e=>c(void 0,null,function*(){try{J(!0),i("speaking"),he(e=>l(r({},e),{voice:"healthy"}));const t=yield fetch(`${q}/elevenlabs/synthesize`,{method:"POST",headers:{Accept:"audio/mpeg","Content-Type":"application/json"},body:JSON.stringify({text:e,voiceId:h,voiceSettings:{stability:ee/100,similarity_boost:se/100}})});if(!t.ok){const e=yield t.text();throw new Error(`Voice synthesis error: ${t.status} ${t.statusText} - ${e}`)}const s=yield t.blob(),n=URL.createObjectURL(s),o=new Audio(n);le.current=o,o.onended=()=>{J(!1),i("ready"),he(e=>l(r({},e),{voice:"healthy"})),URL.revokeObjectURL(n)},o.onerror=()=>{J(!1),i("error"),he(e=>l(r({},e),{voice:"down"})),URL.revokeObjectURL(n)},yield o.play()}catch(t){J(!1),i("error"),he(e=>l(r({},e),{voice:"down"})),alert(`Voice synthesis failed: ${t.message}`)}}),ge=e=>c(void 0,null,function*(){Y(!0),i("transcribing");try{const t=new FormData;t.append("audio",e,"recording.webm");const s=yield fetch(`${q}/whisper/transcribe`,{method:"POST",body:t});if(!s.ok){const e=yield s.text();throw new Error(`Transcription error: ${s.status} ${s.statusText} - ${e}`)}const n=(yield s.json()).text;K(n),re(n),he(e=>l(r({},e),{voice:"healthy"})),n&&n.trim().length>0&&(yield ue.submitJob({prompt:n,sessionId:"voice-mode",metadata:{source:"voice-input"}}))}catch(t){he(e=>l(r({},e),{voice:"down"})),alert(`Transcription failed: ${t.message}`)}finally{Y(!1),i("ready")}});return V.useEffect(()=>{let e;"completed"===ue.status&&(null==(e=ue.result)?void 0:e.final)&&s&&be(ue.result.final)},[ue.status,null==(a=ue.result)?void 0:a.final,s]),d.jsxs(g,{open:e,onClose:t,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{backgroundColor:"#1a1a1a",color:"white",minHeight:"600px"}},children:[d.jsx(v,{sx:{color:"#16A34A",fontWeight:"bold",fontSize:"1.5rem"},children:d.jsxs(m,{display:"flex",alignItems:"center",gap:2,children:[d.jsx(F,{sx:{fontSize:28}}),"Liv Hana Voice Mode Control Center"]})}),d.jsxs(p,{children:[d.jsxs(m,{sx:{mb:3},children:[d.jsx(j,{variant:"body1",sx:{mb:2,color:"#E5E7EB"},children:"Configure Liv Hana's voice synthesis settings and test different voices in real-time."}),d.jsx(L,{voiceStatus:xe.voice,reasoningStatus:xe.reasoning,queueDepth:xe.queueDepth})]}),d.jsxs(m,{sx:{display:"flex",gap:3,flexDirection:{xs:"column",md:"row"}},children:[d.jsx(m,{sx:{flex:1},children:d.jsx(y,{sx:{backgroundColor:"#2d2d2d",mb:3},children:d.jsxs(f,{children:[d.jsx(j,{variant:"h6",sx:{color:"#16A34A",mb:2},children:"Voice Selection"}),d.jsxs(A,{fullWidth:!0,sx:{mb:2},children:[d.jsx(C,{sx:{color:"#E5E7EB"},children:"Select Voice"}),d.jsx(S,{value:h,onChange:e=>{B(e.target.value)},sx:{color:"white","& .MuiSelect-icon":{color:"#16A34A"},"& .MuiOutlinedInput-notchedOutline":{borderColor:"#374151"}},children:H.map(e=>d.jsx(w,{value:e.id,children:d.jsxs(m,{display:"flex",alignItems:"center",gap:1,sx:{width:"100%"},children:[d.jsx(O,{sx:{fontSize:16,color:"#16A34A"}}),d.jsxs(m,{sx:{flex:1},children:[d.jsx(j,{variant:"body2",fontWeight:"medium",children:e.name}),d.jsx(j,{variant:"caption",color:"textSecondary",children:e.description})]}),d.jsx(b,{label:e.gender,size:"small",sx:{ml:"auto",height:16,fontSize:"0.7rem",backgroundColor:"Female"===e.gender?"rgba(245, 158, 11, 0.2)":"rgba(22, 163, 74, 0.2)",color:"Female"===e.gender?"#F59E0B":"#16A34A"}})]})},e.id))})]}),me&&d.jsxs(y,{sx:{backgroundColor:"#374151",p:2},children:[d.jsxs(j,{variant:"h6",sx:{color:"#16A34A",mb:1},children:["Current Voice: ",me.name]}),d.jsx(j,{variant:"body2",sx:{mb:1},children:me.description}),d.jsxs(m,{display:"flex",gap:1,flexWrap:"wrap",children:[d.jsx(b,{label:`Gender: ${me.gender}`,size:"small"}),d.jsx(b,{label:`Age: ${me.age}`,size:"small"}),d.jsx(b,{label:`Accent: ${me.accent}`,size:"small"})]})]})]})})}),d.jsx(m,{sx:{flex:1},children:d.jsx(y,{sx:{backgroundColor:"#2d2d2d"},children:d.jsxs(f,{children:[d.jsx(j,{variant:"h6",sx:{color:"#16A34A",mb:2},children:"Voice Settings"}),d.jsxs(m,{sx:{mb:3},children:[d.jsxs(m,{display:"flex",justifyContent:"space-between",mb:1,children:[d.jsx(j,{variant:"body2",children:"Audio Level"}),d.jsxs(j,{variant:"body2",children:[Z,"%"]})]}),d.jsx(k,{value:Z,onChange:(e,t)=>_(t),min:0,max:100,sx:{color:"#16A34A"}})]}),d.jsxs(m,{sx:{mb:3},children:[d.jsxs(m,{display:"flex",justifyContent:"space-between",mb:1,children:[d.jsx(j,{variant:"body2",children:"Stability"}),d.jsxs(j,{variant:"body2",children:[ee,"%"]})]}),d.jsx(k,{value:ee,onChange:(e,t)=>te(t),min:0,max:100,sx:{color:"#16A34A"}})]}),d.jsxs(m,{sx:{mb:3},children:[d.jsxs(m,{display:"flex",justifyContent:"space-between",mb:1,children:[d.jsx(j,{variant:"body2",children:"Similarity Boost"}),d.jsxs(j,{variant:"body2",children:[se,"%"]})]}),d.jsx(k,{value:se,onChange:(e,t)=>ne(t),min:0,max:100,sx:{color:"#16A34A"}})]})]})})}),d.jsx(m,{sx:{flex:1},children:d.jsx(y,{sx:{backgroundColor:"#2d2d2d",mb:3},children:d.jsxs(f,{children:[d.jsx(j,{variant:"h6",sx:{color:"#16A34A",mb:2},children:"Reasoning Job Status"}),d.jsx(E,{label:"Reasoning Prompt",value:ae,onChange:e=>re(e.target.value),multiline:!0,minRows:3,fullWidth:!0,sx:{mb:2},inputProps:{"data-testid":"reasoning-prompt-input"}}),d.jsx(I,{variant:"contained",color:"primary",sx:{mb:2,backgroundColor:"#16A34A","&:hover":{backgroundColor:"#15803D"}},onClick:()=>c(void 0,null,function*(){try{yield ue.submitJob({prompt:ae,sessionId:"voice-mode",metadata:{source:"voice-panel"}})}catch(e){}}),disabled:["submitting","queued","progress"].includes(ue.status),"data-testid":"reasoning-submit-button",children:"submitting"===ue.status?"Submitting…":"Request Reasoning"}),d.jsxs(j,{variant:"body2",sx:{color:"#E5E7EB",mb:1},"data-testid":"reasoning-status-text",children:["Status: ",ue.status]}),ue.jobId&&d.jsxs(j,{variant:"body2",sx:{color:"#9CA3AF",mb:1},"data-testid":"reasoning-job-id",children:["Job ID: ",ue.jobId]}),ue.error&&d.jsxs(j,{variant:"body2",sx:{color:"#F87171",mb:1},"data-testid":"reasoning-error",children:["Error: ",ue.error]}),(null==(u=ue.result)?void 0:u.partial)&&d.jsxs(j,{variant:"body2",sx:{color:"#E5E7EB",mb:1},"data-testid":"reasoning-partial",children:["Partial: ",ue.result.partial]}),(null==(x=ue.result)?void 0:x.final)&&d.jsxs(j,{variant:"body2",sx:{color:"#16A34A",mb:1},"data-testid":"reasoning-final",children:["Final: ",ue.result.final]}),d.jsx(I,{variant:"outlined",color:"primary",sx:{mt:2,borderColor:"#16A34A",color:"#16A34A"},onClick:ue.reset,"data-testid":"reasoning-reset-button",children:"Reset"})]})})})]}),d.jsxs(m,{sx:{mt:3,display:"flex",gap:2,justifyContent:"center",flexWrap:"wrap"},children:[d.jsx(I,{variant:"contained",startIcon:G?d.jsx(M,{}):d.jsx(P,{}),onClick:G?()=>{ce.current&&"recording"===ce.current.state&&(ce.current.stop(),N(!1),i("processing"))}:()=>c(void 0,null,function*(){try{const e=yield navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e,{mimeType:"audio/webm;codecs=opus"});ce.current=t,de.current=[],t.ondataavailable=e=>{e.data.size>0&&de.current.push(e.data)},t.onstop=()=>c(void 0,null,function*(){e.getTracks().forEach(e=>e.stop());const t=new Blob(de.current,{type:"audio/webm"});yield ge(t)}),t.start(),N(!0),i("listening"),he(e=>l(r({},e),{voice:"healthy"}))}catch(e){alert(`Microphone access failed: ${e.message}`),he(e=>l(r({},e),{voice:"down"}))}}),disabled:U||X,sx:{backgroundColor:G?"#EF4444":"#16A34A","&:hover":{backgroundColor:G?"#DC2626":"#15803D"},minWidth:200,animation:G?"pulse 1.5s ease-in-out infinite":"none","@keyframes pulse":{"0%, 100%":{opacity:1},"50%":{opacity:.7}}},"data-testid":"voice-input-button",children:G?"Stop Listening":"Start Voice Input"}),d.jsx(I,{variant:"contained",startIcon:oe?d.jsx(D,{size:20}):d.jsx(W,{}),onClick:()=>c(void 0,null,function*(){if(U)return void alert("Please wait for current audio to finish.");ie(!0);try{yield be("Hello! This is a test of the ElevenLabs voice synthesis system. I'm speaking with the selected voice.")}finally{ie(!1)}}),disabled:U||oe||G||X,sx:{backgroundColor:"#16A34A","&:hover":{backgroundColor:"#15803D"},minWidth:200},"data-testid":"test-voice-button",children:oe?"Testing Voice...":`Test ${(null==me?void 0:me.name)||"Voice"}`}),d.jsx(I,{variant:"outlined",startIcon:d.jsx(z,{}),onClick:()=>{le.current&&(le.current.pause(),le.current.currentTime=0,J(!1),i("ready"),he(e=>l(r({},e),{voice:"healthy"})))},disabled:!U,sx:{borderColor:"#EF4444",color:"#EF4444","&:hover":{borderColor:"#DC2626",color:"#DC2626"},minWidth:150},"data-testid":"stop-speaking-button",children:"Stop Speaking"})]}),(X||Q)&&d.jsxs(R,{sx:{mt:3,p:2,backgroundColor:"#2d2d2d"},children:[d.jsx(j,{variant:"h6",sx:{color:"#16A34A",mb:1},children:X?"Transcribing...":"Last Transcription"}),d.jsx(j,{variant:"body2",sx:{color:"#E5E7EB"},children:X?d.jsx(D,{size:20}):Q})]}),d.jsxs(R,{sx:{mt:3,p:2,backgroundColor:"#374151"},"data-testid":"voice-mode-status",children:[d.jsx(j,{variant:"h6",sx:{color:"#16A34A",mb:1},children:"System Status"}),d.jsxs(m,{display:"flex",alignItems:"center",gap:2,flexWrap:"wrap",children:[d.jsx(b,{label:"Voice Mode: "+(s?"Active":"Inactive"),color:s?"success":"default"}),d.jsx(b,{label:`Agent Status: ${o}`,color:"ready"===o?"success":["speaking","listening","transcribing"].includes(o)?"warning":"error"}),d.jsx(b,{label:`Reasoning Status: ${ue.status}`,color:["completed","idle"].includes(ue.status)?"success":"error"===ue.status?"error":"warning","data-testid":"reasoning-status-chip"}),d.jsx(b,{label:"Voice Service: "+("healthy"===xe.voice||"degraded"===xe.voice?"Connected":"Disconnected"),color:"healthy"===xe.voice?"success":"degraded"===xe.voice?"warning":"error"}),G&&d.jsx(b,{label:"🎤 LISTENING",sx:{backgroundColor:"#EF4444",color:"white",animation:"pulse 1.5s ease-in-out infinite"}}),X&&d.jsx(b,{label:"✍️ TRANSCRIBING",sx:{backgroundColor:"#F59E0B",color:"white"}})]})]})]}),d.jsxs(T,{sx:{justifyContent:"space-between",p:3},children:[d.jsx(I,{onClick:t,variant:"outlined",sx:{borderColor:"#374151",color:"#E5E7EB"},"data-testid":"close-voice-mode",children:"Close"}),d.jsx(m,{display:"flex",gap:2,children:d.jsx(I,{onClick:n,variant:"contained",startIcon:s?d.jsx(M,{}):d.jsx(P,{}),sx:{backgroundColor:s?"#EF4444":"#16A34A","&:hover":{backgroundColor:s?"#DC2626":"#15803D"}},"data-testid":"toggle-voice-mode",children:s?"Disable Voice Mode":"Enable Voice Mode"})})]})]})};export{U as default};
