{
  "session_start": "2025-10-23T00:25:00Z",
  "planning_agent": "Layer 1.1 - Universal Taskmaster",
  "mission": "Prevent crashes, fix bugs, perfect boot, complete session",
  "token_budget_total": 200000,
  "token_usage_current": 25823,
  "token_remaining": 174177,
  "crash_prevention_active": true,

  "critical_findings": {
    "cli_status": "CORRECT - Homebrew /opt/homebrew/bin/claude v2.0.25",
    "node_version": "v24.10.0 (exceeds Node 20+ requirement)",
    "voice_services": "ACTIVE - STT:2022, TTS:8880",
    "concurrent_sessions": "WARNING - 4+ Claude processes detected (crash risk)",
    "memory_status": "UNKNOWN - requires check",
    "boot_script_status": "COMPLETE - includes voice watcher + research launcher"
  },

  "guard_rails": {
    "max_tokens_per_agent": 20000,
    "max_concurrent_writers": 3,
    "file_operation_mode": "atomic_only",
    "qa_validation_required": true,
    "status_report_interval_minutes": 10
  },

  "task_breakdown": {
    "T1_cli_autoupdate_fix": {
      "priority": "CRITICAL",
      "owner": "1.4_execution",
      "status": "pending",
      "estimated_minutes": 5,
      "dependencies": [],
      "actions": [
        "Verify no npm global @anthropic-ai/claude-code exists",
        "Confirm Homebrew installation at /opt/homebrew/bin/claude",
        "Add NO_UPDATE_NOTIFIER=1 to scripts/claude_voice_session.sh",
        "Add CI=1 to scripts/claude_voice_session.sh",
        "Test: which claude shows only /opt/homebrew/bin/claude"
      ],
      "verification": "which claude && claude --version shows no npm path",
      "token_estimate": 5000
    },

    "T2_boot_script_perfect": {
      "priority": "HIGH",
      "owner": "1.4_execution",
      "status": "pending",
      "estimated_minutes": 10,
      "dependencies": ["T1_cli_autoupdate_fix"],
      "actions": [
        "Verify all 5 subagents (1.1-1.5) launch from boot script",
        "Confirm voice orchestrator watcher starts (line 192-194, 576-584)",
        "Confirm research agent launches (line 196-202, 587-600)",
        "Add Node 20+ enforcement validation",
        "Test full reboot cycle with clean state"
      ],
      "verification": "ps aux | grep shows voice_watcher + research PIDs",
      "token_estimate": 8000,
      "notes": "Boot script already includes voice watcher (line 192-194, 576-584) and research agent (line 196-202, 587-600)"
    },

    "T3_cursor_crash_prevention": {
      "priority": "CRITICAL",
      "owner": "1.5_qa",
      "status": "pending",
      "estimated_minutes": 15,
      "dependencies": [],
      "actions": [
        "Monitor token usage across all agents (current: 25823/200000)",
        "Kill redundant Claude processes (4+ detected)",
        "Enforce context window limits per agent (20K max)",
        "Add file operation throttling (max 3 concurrent writers)",
        "Implement memory monitoring (warn <500MB, critical <2GB)",
        "Test under load with simulated multi-agent activity"
      ],
      "verification": "System stable after 30min multi-agent operation",
      "token_estimate": 12000,
      "critical_actions": {
        "immediate": "Kill redundant Claude processes to free memory",
        "session_end": "ps aux | grep claude | wc -l < 3"
      }
    },

    "T4_custom_greeting": {
      "priority": "MEDIUM",
      "owner": "1.4_execution",
      "status": "pending",
      "estimated_minutes": 5,
      "dependencies": ["T2_boot_script_perfect"],
      "actions": [
        "Add auto-greeting to boot script post-launch",
        "Text: 'Hey Jesse, Liv Hana here, full state. War's won. Time to remind them. Execute.'",
        "Trigger via mcp__voicemode__converse after boot completes",
        "Test greeting fires on clean boot"
      ],
      "verification": "Voice greeting plays within 3 seconds of boot completion",
      "token_estimate": 4000,
      "notes": "Boot script already has voice instructions at line 336-415"
    },

    "T5_mobile_control_slack": {
      "priority": "LOW",
      "owner": "1.3_artifacts + 1.4_execution",
      "status": "pending",
      "estimated_minutes": 30,
      "dependencies": ["T1_cli_autoupdate_fix", "T2_boot_script_perfect"],
      "actions": [
        "Implement Slack bridge per docs/mobile-control.md",
        "backend/integration-service/src/slack/bridge.ts - signature/JWT/rate limit",
        "backend/reasoning-gateway/src/jobs/slack-commands.ts - queue consumer",
        "Set up Cloudflare tunnel with JWT + Slack signature validation",
        "Create allowlisted scripts for /agent commands",
        "Test /agent status, /agent start, /agent silence commands"
      ],
      "verification": "/agent status returns system health from Slack",
      "token_estimate": 25000,
      "notes": "Defer until after critical tasks complete - requires artifacts + execution"
    },

    "T6_mobile_control_tailscale": {
      "priority": "LOW",
      "owner": "1.4_execution",
      "status": "pending",
      "estimated_minutes": 20,
      "dependencies": ["T2_boot_script_perfect"],
      "actions": [
        "Install Tailscale on Mac if not present",
        "Create tmux helpers: scripts/mobile/{vmute,vresume,vstatus}.sh",
        "Create bootstrap: scripts/mobile/start-voice-session.sh",
        "Test SSH via Tailscale from mobile",
        "Test tmux session 'voice' with helper scripts"
      ],
      "verification": "ssh <tailscale-ip> 'tmux ls' shows 'voice' session",
      "token_estimate": 15000
    }
  },

  "execution_sequence": [
    {
      "phase": "IMMEDIATE_STABILIZATION",
      "tasks": ["T3_cursor_crash_prevention"],
      "critical": true,
      "parallel": false
    },
    {
      "phase": "CLI_FIXES",
      "tasks": ["T1_cli_autoupdate_fix"],
      "critical": true,
      "parallel": false
    },
    {
      "phase": "BOOT_PERFECTION",
      "tasks": ["T2_boot_script_perfect", "T4_custom_greeting"],
      "critical": true,
      "parallel": false
    },
    {
      "phase": "MOBILE_CONTROL",
      "tasks": ["T5_mobile_control_slack", "T6_mobile_control_tailscale"],
      "critical": false,
      "parallel": true,
      "defer": "after critical tasks complete"
    }
  ],

  "status_reports": {
    "next_report": "2025-10-23T00:35:00Z",
    "interval_minutes": 10,
    "alert_on": ["crash_risk", "token_overflow", "agent_failure"]
  },

  "coordination_protocol": {
    "liv_hana_role": "Pure orchestration with Jesse - no task execution",
    "planning_agent_role": "Task coordination, efficiency optimization, crash prevention",
    "research_agent_role": "Continuous intelligence, feeds Planning + Liv Hana",
    "artifacts_agent_role": "Architecture, documentation, system design",
    "execution_agent_role": "Code changes, deployments, script execution",
    "qa_agent_role": "Validation, testing, guardrails enforcement"
  },

  "next_actions": {
    "immediate": [
      "Check system memory status",
      "Kill redundant Claude processes (4+ detected)",
      "Task 1.5 QA: Implement crash prevention monitoring"
    ],
    "after_stabilization": [
      "Task 1.4 Execution: Fix CLI auto-update bug",
      "Task 1.4 Execution: Perfect boot script validation",
      "Task 1.4 Execution: Add custom greeting"
    ],
    "deferred": [
      "Task 1.3 Artifacts + 1.4 Execution: Mobile control (Slack + Tailscale)"
    ]
  },

  "session_state": "ACTIVE - Planning Agent coordinating, awaiting Liv Hana orchestration"
}
